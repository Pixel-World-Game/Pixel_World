<!DOCTYPE html><html lang="en" class="no-js">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<script type="text/javascript" src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836" data-dLayer-ignore="true" data-document-language="true"></script><script type="text/javascript">function OptanonWrapper() {}</script><script>window.dataLayer = window.dataLayer || []; dataLayer.push({ event: 'dataLayer-initialized', user: { user_unity_id: undefined, user_logged_in: 'no' }, environment: { environment_locale: 'en-us', environment_currency: undefined }});</script><script>var offline=(location.href.indexOf('docs.unity3d.com')==-1)?true:false;if(!offline){(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=   'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);  })(window,document,'script','dataLayer','GTM-5V25JL6');}</script><link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unity - Manual: Thread safe types</title>
<meta property="og:image" content="https://unity3d.com/files/images/ogimg.jpg">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFilesManual/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFilesManual/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFilesManual/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFilesManual/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFilesManual/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFilesManual/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFilesManual/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFilesManual/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="/StaticFilesConfig/UnityVersionsInfo.js"></script><script type="text/javascript" src="../StaticFilesManual/js/jquery.js?ts=20241003"></script><script type="text/javascript" src="../StaticFilesManual/js/core.js?ts=20241003"></script><script type="text/javascript" src="docdata/toc.js?ts=20241003"></script><script type="text/javascript" src="docdata/global_toc.js?ts=20241003"></script><link rel="stylesheet" type="text/css" href="../StaticFilesManual/css/core.css?ts=20241003">
<link rel="stylesheet" href="../StaticFilesManual/css/prism.css">
<script src="../StaticFilesManual/js/prism.js"></script><script src="/StaticFilesConfig/feedback/feedback.js"></script><script src="../StaticFilesManual/js/jquery.sidebar.min.js"></script><link rel="stylesheet" href="../StaticFilesManual/css/mobileoptimisation.css">
<script src="../StaticFilesManual/js/mobileoptimisation.js"></script>
</head>
<body>
<div id="DocsAnalyticsData" data-area="none" data-pagetype="manual"></div>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="https://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul>
<li><a href="../Manual/index.html" class="selected">Manual</a></li>
<li><a href="../ScriptReference/index.html">Scripting API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity.com/">unity.com</a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="toggle version-number" id="VersionNumber" data-target=".otherversionscontent">
                                Version: <b>2022.3</b><div class="otherversionscontent" id="OtherVersionsContent" style="display: none;">
<ul id="OtherVersionsContentUl"></ul>
<div id="otherVersionsLegend"><ul>
<li>
<div id="supportedColour" class="legendBox"></div>Supported</li>
<li>
<div id="notFoundColour" class="legendBox"></div>Legacy</li>
</ul></div>
</div>
<div id="VersionSwitcherArrow" class="arrow versionSwitcherArrow"></div>
</div>
<div class="lang-switcher"><div class="current toggle" data-target=".lang-list">
<div class="lbl">Language
:                <span class="b">English</span>
</div>
<div class="arrow"></div>
<div class="lang-list" style="display:none;"><ul>
<li><a href="/Manual/JobSystemNativeContainer.html">English</a></li>
<li><a href="/cn/current/Manual/JobSystemNativeContainer.html">中文</a></li>
<li><a href="/ja/current/Manual/JobSystemNativeContainer.html">日本語</a></li>
<li><a href="/kr/current/Manual/JobSystemNativeContainer.html">한국어</a></li>
</ul></div>
</div></div>
</div></div>
<div class="mobileLogo"><a href="https://docs.unity3d.com"></a></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc" id="customScrollbar">
<h2>Unity Manual</h2>
<div class="search-form sidebar-search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" id="mobileSearchBtn" class="submit" value="Search">
</form></div>
<div class="toggle version-number sidebar-version-switcher" id="VersionNumber" data-target=".otherversionscontent"><form id="otherVersionsContentMobileForm"><div class="ui-field-contain">
<label for="select-native-4">Version: 2022.3</label><select name="select-native-4" id="versionsSelectMobile"><option>Select a different version</option>
<optgroup id="versionsWithThisPageMobile" label="Versions with this page"></optgroup>
<optgroup id="versionsWithoutThisPageMobile" label="Versions without this page"></optgroup></select>
</div></form></div>
<div class="lang-switcher"><div class="current toggle" data-target=".lang-list">
<div class="lbl">Language
:                <span class="b">English</span>
</div>
<div class="arrow"></div>
<div class="lang-list" style="display:none;"><ul>
<li><a href="/Manual/JobSystemNativeContainer.html">English</a></li>
<li><a href="/cn/current/Manual/JobSystemNativeContainer.html">中文</a></li>
<li><a href="/ja/current/Manual/JobSystemNativeContainer.html">日本語</a></li>
<li><a href="/kr/current/Manual/JobSystemNativeContainer.html">한국어</a></li>
</ul></div>
</div></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="ScriptingSection.html">Scripting</a></li>
<li><a href="JobSystem.html">Job system </a></li>
<li>Thread safe types</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="job-system-jobs.html"></a></span><div class="tip">Jobs overview </div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="job-system-custom-nativecontainer.html"></a></span><div class="tip">Implement a custom native container</div>
</div>
</div></div>
<div id="_leavefeedback"></div>
<h1>Thread safe types</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>The job system works best when you use it with the <a href="https://docs.unity3d.com/Packages/com.unity.burst@latest/">Burst compiler</a>. Because Burst doesn’t support managed objects, you need to use unmanaged types to access the data in jobs. You can do this with <a href="https://learn.microsoft.com/en-us/dotnet/framework/interop/blittable-and-non-blittable-types">blittable types</a>, or use Unity’s built-in <a href="../ScriptReference/Unity.Collections.LowLevel.Unsafe.NativeContainerAttribute.html"><code>NativeContainer</code></a> objects, which are a thread-safe C# wrapper for native memory. <code>NativeContainer</code> objects also allow a job to access data shared with the <a href="JobSystemOverview.html#multithreading">main thread</a> rather than working with a copy.</p>

<h2>Types of NativeContainers</h2>

<p>The <code>Unity.Collections</code> namespace contains the following built-in <code>NativeContainer</code> objects:</p>

<ul>
<li>
<a href="../ScriptReference/Unity.Collections.NativeArray_1.html"><code>NativeArray</code></a>: An unmanaged array which exposes a buffer of native memory to managed code</li>
<li>
<a href="../ScriptReference/Unity.Collections.NativeSlice_1.html"><code>NativeSlice</code></a>: Gets a subset of a <code>NativeArray</code> from a particular position to a certain length.</li>
</ul>

<p>
<strong>Note:</strong> The <a href="https://docs.unity3d.com/Packages/com.unity.collections@latest/">Collections package</a> contains additional <code>NativeContainer</code>s. For a full list of the additional types, see the Collections documentation on <a href="https://docs.unity3d.com/Packages/com.unity.collections@latest/index.html?subfolder=/manual/collection-types.html">Collection types</a>.</p>

<h2>Read and write access</h2>

<p>By default, when a job has access to a <code>NativeContainer</code> instance, it has both read and write access. This configuration can slow performance. This is because the job system doesn’t allow you to schedule a job that has write access to a <code>NativeContainer</code> instance at the same time as another job that’s writing to it.</p>

<p>However, If a job doesn’t need to write to a <code>NativeContainer</code> instance, you can mark the <code>NativeContainer</code> with the <code>[ReadOnly]</code> attribute, like so:</p>

<pre><code class="lang-cs">[ReadOnly]
public NativeArray&lt;int&gt; input;
</code></pre>

<p>In the above example, you can execute the job at the same time as other jobs that also have read-only access to the first <code>NativeArray</code>.</p>

<h2>Memory allocators</h2>

<p>When you create a <code>NativeContainer</code>instance, you must specify the memory allocation type that you need. The allocation type you use depends on how long you would like to keep the native container available for. This way you can tailor the allocation to get the best performance possible in each situation.</p>

<p>There are three <a href="../ScriptReference/Unity.Collections.Allocator.html">Allocator</a> types for <code>NativeContainer</code> memory allocation and release. You must specify the appropriate one when instantiating a <code>NativeContainer</code> instance:</p>

<ul>
<li>
<code>Allocator.Temp</code>: The fastest allocation. Use it for allocations with a lifespan of one frame or fewer. You can’t use <code>Temp</code> to pass allocations to <code>NativeContainer</code> instances stored in a job’s member field.</li>
<li>
<code>Allocator.TempJob</code>: A slower allocation than <code>Temp</code> but faster than <code>Persistent</code>. Use it for thread-safe allocations within a lifespan of four frames. <strong>Important</strong>: You must <code>Dispose</code> of this allocation type within four frames, or the console prints a warning, generated from the native code. Most small jobs use this allocation type.</li>
<li>
<code>Allocator.Persistent</code>: The slowest allocation but can last as long as you need it to, and if necessary, throughout the application’s lifetime. It’s a wrapper for a direct call to <a href="http://www.cplusplus.com/reference/cstdlib/malloc/"><code>malloc</code></a>. Longer jobs can use this NativeContainer allocation type. Don’t use <code>Persistent</code> where performance is essential.</li>
</ul>

<p>For example:</p>

<pre><code class="lang-cs">NativeArray&lt;float&gt; result = new NativeArray&lt;float&gt;(1, Allocator.TempJob);
</code></pre>

<p>
<strong>Note:</strong> The number 1 in the example above indicates the size of the NativeArray. In this case, it has only one array element because it only stores one piece of data in its result.</p>

<p><a name="safety-system"></a></p>

<h2>NativeContainer safety system</h2>

<p>The <a href="JobSystemOverview.html#safety-system">safety system</a> is built into all <code>NativeContainer</code> instances. It tracks what reads or writes to any <code>NativeContainer</code> instance, and uses that information to enforce certain rules on the use of <code>NativeContainer</code>s that makes them behave in a deterministic way across multiple jobs and threads.</p>

<p>For example, if two independent scheduled jobs write to the same <code>NativeArray</code>, this is unsafe because you can’t predict which job executes first. This means that you won’t know which of the jobs will overwrite data from the other. The safety system throws an exception with a clear error message that explains why and how to solve the problem, when you schedule the second job.</p>

<p>If you want to schedule two jobs that write to the same <code>NativeContainer</code> instance, you can schedule the <a href="JobSystemJobDependencies.html">jobs with a dependency</a>. The first job writes to the <code>NativeContainer</code>, and once it has finished executing, the next job safely reads and writes to that same <code>NativeContainer</code>. Introducing the dependency guarantees that the jobs always execute in a consistent order and that the resulting data in the <code>NativeContainer</code> is deterministic.</p>

<p>The safety system allows multiple jobs to read from the same data in parallel.</p>

<p>These read and write restrictions also apply when accessing data from the main thread. For example, if you try to read the contents of a NativeContainer before the job that writes to it has completed, the safety system throws an error. Likewise, if you try to write to a NativeContainer while there are still pending jobs that read or write to it, then the safety system also throws an error.</p>

<p>Also, because NativeContainers don’t implement <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/ref-returns"><code>ref return</code></a>, you can’t directly change the contents of a <code>NativeContainer</code>. For example, <code>nativeArray[0]++;</code> is the same as writing <code>var temp = nativeArray[0]; temp++;</code> which doesn’t update the value in <code>nativeArray</code>.</p>

<p>Instead, you must copy the data from the index into a local temporary copy, modify that copy, and save it back. For example:</p>

<pre><code class="lang-cs">MyStruct temp = myNativeArray[i];
temp.memberVariable = 0;
myNativeArray[i] = temp;
</code></pre>

<h2>Additional resources</h2>

<ul>
<li><a href="job-system-custom-nativecontainer.html">Implement a custom <code>NativeContainer</code></a></li>
</ul>
<div id="_content"></div>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="job-system-jobs.html"></a></span><div class="tip">Jobs overview </div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="job-system-custom-nativecontainer.html"></a></span><div class="tip">Implement a custom native container</div>
</div>
</div>
</div>
<div class="footer-wrapper"><div class="footer clear">
<div class="copy">Copyright © 2024 Unity Technologies. Publication Date: 2024-10-03.</div>
<div class="menu">
<a href="https://learn.unity.com/">Tutorials</a><a href="https://answers.unity3d.com">Community Answers</a><a href="https://support.unity3d.com/hc/en-us">Knowledge Base</a><a href="https://forum.unity3d.com">Forums</a><a href="https://unity3d.com/asset-store">Asset Store</a><a href="https://docs.unity3d.com/Manual/TermsOfUse.html">Terms of use</a><a href="https://unity.com/legal">Legal</a><a href="https://unity.com/legal/privacy-policy">Privacy Policy</a><a href="https://unity.com/legal/cookie-policy">Cookies</a><a href="https://unity.com/legal/do-not-sell-my-personal-information">Do Not Sell or Share My Personal Information</a><div id="ot-sdk-btn-container"><a id="ot-sdk-btn" class="ot-sdk-show-settings" href="javascript:void(0);">Your Privacy Choices (Cookie Settings)</a></div>
</div>
</div></div>
</div></div></div>
</div>
</body>
</html>
