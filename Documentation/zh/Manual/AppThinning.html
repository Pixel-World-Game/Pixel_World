<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="应用程序精简 - Unity 手册">
<title>应用程序精简 - Unity 手册</title>
<meta property="og:image" content="https://docs.unity3d.com/cn/2022.3/uploads/Main/AppThinning-BuildSettings.png">
<meta name="description" content="Apple 商店和 iOS 可根据用户具体设备的性能来定制 iOS、tvOS 和 watchOS 应用程序的分发，从而优化这些应用程序的安装。此优化称为应用程序精简。借助应用程序精简，可以使创建的应用程序利用最多的设备功能、占用最少的磁盘空间并适应 Apple 未来可能应用的更新。请参阅 Apple 关于应用程序精简的开发者库页面，了解有关此优化过程的更多信息。">
<meta property="og:description" content="Apple 商店和 iOS 可根据用户具体设备的性能来定制 iOS、tvOS 和 watchOS 应用程序的分发，从而优化这些应用程序的安装。此优化称为应用程序精简。借助应用程序精简，可以使创建的应用程序利用最多的设备功能、占用最少的磁盘空间并适应 Apple 未来可能应用的更新。请参阅 Apple 关于应用程序精简的开发者库页面，了解有关此优化过程的更多信息。">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836" data-dLayer-ignore="true" data-document-language="true"></script><script type="text/javascript">function OptanonWrapper() {}</script><script>window.dataLayer = window.dataLayer || []; dataLayer.push({ event: 'dataLayer-initialized', user: { user_unity_id: undefined, user_logged_in: 'no' }, environment: { environment_locale: '', environment_currency: undefined }});</script><script>var offline=(location.href.indexOf('docs.unity3d.com')==-1)?true:false;if(!offline){(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=   'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);  })(window,document,'script','dataLayer','GTM-5V25JL6');}</script><script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'AppThinning';
      if(!page) page = 'index';
      var version = '2022.3';
      var docs_versions = [{version: '2023.2',version_string: '2023.2',supported: true},{version: '2023.1',version_string: '2023.1',supported: false},{version: '2022.3',version_string: '2022.3',supported: true},{version: '2022.2',version_string: '2022.2',supported: false},{version: '2022.1',version_string: '2022.1',supported: false},{version: '2021.3',version_string: '2021.3',supported: true},{version: '2021.2',version_string: '2021.2',supported: false},{version: '2021.1',version_string: '2021.1',supported: false},{version: '2020.3',version_string: '2020.3',supported: false},{version: '2020.2',version_string: '2020.2',supported: false},{version: '2020.1',version_string: '2020.1',supported: false},{version: '2019.4',version_string: '2019.4',supported: false},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: false},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><script src="/StaticFilesConfig/feedback/feedback.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/2022.3/Manual/AppThinning.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2022.3/Manual/AppThinning.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/cn/2022.3/Manual/AppThinning.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity3d.com/ja/2022.3/Manual/AppThinning.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/kr/2022.3/Manual/AppThinning.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/2022.3/Documentation/Manual/AppThinning.html" hreflang="x-default">
</head>
<body>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2022.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2023.2" href="/cn/2023.2/Manual/AppThinning.html">2023.2</a></li>
<li class=""><a class="docs_version_url_2023.1" href="/cn/2023.1/Manual/AppThinning.html">2023.1</a></li>
<li class="supported"><a class="docs_version_url_2022.3" href="/cn/2022.3/Manual/AppThinning.html">2022.3</a></li>
<li class=""><a class="docs_version_url_2022.2" href="/cn/2022.2/Manual/AppThinning.html">2022.2</a></li>
<li class=""><a class="docs_version_url_2022.1" href="/cn/2022.1/Manual/AppThinning.html">2022.1</a></li>
<li class="supported"><a class="docs_version_url_2021.3" href="/cn/2021.3/Manual/AppThinning.html">2021.3</a></li>
<li class=""><a class="docs_version_url_2021.2" href="/cn/2021.2/Manual/AppThinning.html">2021.2</a></li>
<li class=""><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/AppThinning.html">2021.1</a></li>
<li class=""><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/AppThinning.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/AppThinning.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/AppThinning.html">2020.1</a></li>
<li class=""><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/AppThinning.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/AppThinning.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/AppThinning.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/AppThinning.html">2019.1</a></li>
<li class=""><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/AppThinning.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/AppThinning.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/AppThinning.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/AppThinning.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/AppThinning.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/AppThinning.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/AppThinning.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/AppThinning.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/AppThinning.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2022.3/Documentation/Manual/AppThinning.html">English</a></li>
<li><a data-lang="cn" href="/cn/2022.3/Manual/AppThinning.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2022.3/Manual/AppThinning.html">日本語</a></li>
<li><a data-lang="kr" href="/kr/2022.3/Manual/AppThinning.html">한국어</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2022.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2023.2" href="/cn/2023.2/Manual/AppThinning.html">2023.2</a></li>
<li class=""><a class="docs_version_url_2023.1" href="/cn/2023.1/Manual/AppThinning.html">2023.1</a></li>
<li class="supported"><a class="docs_version_url_2022.3" href="/cn/2022.3/Manual/AppThinning.html">2022.3</a></li>
<li class=""><a class="docs_version_url_2022.2" href="/cn/2022.2/Manual/AppThinning.html">2022.2</a></li>
<li class=""><a class="docs_version_url_2022.1" href="/cn/2022.1/Manual/AppThinning.html">2022.1</a></li>
<li class="supported"><a class="docs_version_url_2021.3" href="/cn/2021.3/Manual/AppThinning.html">2021.3</a></li>
<li class=""><a class="docs_version_url_2021.2" href="/cn/2021.2/Manual/AppThinning.html">2021.2</a></li>
<li class=""><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/AppThinning.html">2021.1</a></li>
<li class=""><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/AppThinning.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/AppThinning.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/AppThinning.html">2020.1</a></li>
<li class=""><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/AppThinning.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/AppThinning.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/AppThinning.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/AppThinning.html">2019.1</a></li>
<li class=""><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/AppThinning.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/AppThinning.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/AppThinning.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/AppThinning.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/AppThinning.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/AppThinning.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/AppThinning.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/AppThinning.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/AppThinning.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual 2022.3 (LTS)</a></li>
<li><a href="PlatformSpecific.html">平台开发</a></li>
<li><a href="iphone.html">iOS</a></li>
<li><a href="ios-building-and-delivering.html">Building and delivering for iOS</a></li>
<li>应用程序精简</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="iphone-BuildProcess.html"></a></span><div class="tip">Build for iOS</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="apple-privacy-manifest-policy.html"></a></span><div class="tip">Apple’s privacy manifest policy requirements</div>
</div>
</div></div>
<h1>应用程序精简</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>Apple 商店和 iOS 可根据用户具体设备的性能来定制 iOS、tvOS 和 watchOS 应用程序的分发，从而优化这些应用程序的安装。此优化称为应用程序精简。借助应用程序精简，可以使创建的应用程序利用最多的设备功能、占用最少的磁盘空间并适应 Apple 未来可能应用的更新。请参阅 <a href="https://developer.apple.com/library/tvos/documentation/IDEs/Conceptual/AppDistributionGuide/AppThinning/AppThinning.html">Apple 关于应用程序精简的开发者库页面</a>，了解有关此优化过程的更多信息。</p>

<p>Unity lets you implement the following two major components for app thinning:</p>

<ul>
<li><a href="#OnDemandResources">按需加载资源 (ODR)</a></li>
<li><a href="#AppSlicing">应用程序切片</a></li>
</ul>

<p><a name="OnDemandResources"></a> </p>

<h1>按需加载资源</h1>

<p>On-demand resources (ODR) is a feature available for the iOS and tvOS platforms, from version 9.0 of iOS and tvOS onwards. It allows you to reduce the size of your application by separating the core Assets (those that are needed from application startup) from Assets which may be optional, or which appear in later levels of your game. These additional Assets are called <a href="AssetBundlesIntro.html">AssetBundles</a> that are available across all Unity build targets, but you must take additional steps to enable them for hosting from the App Store.</p>

<p>AssetBundles can contain Asset files such as models, Materials, Textures, and Scenes, but they can’t include scripts. Therefore, all your scripting logic must reside in the main application. Apple recommends that an AssetBundle be no larger than 64MB in size, to reduce loading time (particularly over-the-air) and minimize the amount of storage space used on the device.</p>

<h2>设置 ODR</h2>

<p>要对项目进行 ODR 设置，请首先确认构建类型设置为 iOS。在菜单栏中，选择 <strong>File</strong> &gt; <strong>Build Settings</strong>。</p>

<figure>
<img src="../uploads/Main/AppThinning-BuildSettings.png" alt="">
</figure>

<p>如果尚未选中相关选项，请单击 <strong>iOS__，然后单击 </strong>Switch Platform__ 按钮。接下来，单击 <strong>Player Settings</strong> 按钮。在 Inspector 窗口中，打开 <strong>Other Settings__，导航到 </strong>Configuration__ 部分，然后启用 <strong>Use on demand resources</strong> 复选框。</p>

<figure>
<img src="../uploads/Main/AppThinning-OtherSettings.png" alt="">
</figure>

<h2>创建 AssetBundle</h2>

<p>首先，创建一个新文件夹以放置需要添加到 AssetBundle 的资源。要执行此操作，请在 Project 窗口内右键单击，然后选择 <strong>Create</strong> &gt; <strong>Folder__（或单击 Project 窗口左上角的 </strong>Create__ &gt; __Folder__）。</p>

<figure>
<img src="../uploads/Main/AppThinning-CreateFolder.png" alt="">
</figure>

<p>选择要添加到 AssetBundle 的资源文件，然后将它们拖放到新文件夹中。</p>

<p>创建 AssetBundle 时，需要为其分配一个标签，该标签将在请求下载 AssetBundle 时用作标识符。最好创建一个与捆绑包的文件名匹配的标签；这样可以确保标签的唯一性，并便于以后使用时进行识别。</p>

<p>要创建或分配标签，请选择新文件夹，然后导航到 Inspector 窗口底部的 Asset Labels 部分。单击左侧下拉菜单，选择 __New__，然后输入新标签的名称。请注意，AssetBundle 标签必须为小写字母。</p>

<figure>
<img src="../uploads/Main/AppThinning-AssetLabels.png" alt="">
</figure>

<p>In this example, a folder called <em>Textures</em> is being given a new label.</p>

<p>To generate the new AssetBundle file, you must references the new label in an Editor script. To create an Editor script, create a new folder inside the Project window called <em>Editor</em>. Right-click on the <em>Editor</em> folder and select <strong>Create</strong> &gt; <strong>C# Script</strong>. Name the new script <strong>BuildiOSAssetBundles.cs</strong>.</p>

<figure>
<img src="../uploads/Main/AppThinning-NewScript.png" alt="">
</figure>

<p>In this example, the <em>Textures</em> folder has the label <em>textures</em> and the new script <strong>BuildiOSAssetBundles.cs</strong> is created in the <em>Editor</em> folder.</p>

<p>Open <strong>BuildiOSAssetBundles.cs</strong> and copy in the code below. In this example, the label <em>textures</em> is used; change this throughout with the name of your label (in lower-case text).</p>

<p>Note that this example uses uncompressed bundles; however, this isn’t a requirement for app thinning.</p>

<pre><code>using UnityEngine;
using UnityEditor;


public class BuildiOSAssetBundles : MonoBehaviour
{
    [InitializeOnLoadMethod]
    static void SetupResourcesBuild( )
    {
        UnityEditor.iOS.BuildPipeline.collectResources += CollectResources;
    }

    static UnityEditor.iOS.Resource[] CollectResources( )
    {
        return new UnityEditor.iOS.Resource[]
        {
            new UnityEditor.iOS.Resource( "textures", "Assets/ODR/textures" ).AddOnDemandResourceTags( "textures" ),
            new UnityEditor.iOS.Resource( "bundle", "Assets/Bundles/bundle.unity3d" ).AddOnDemandResourceTags( "bundle" ),
        };
    }

    [MenuItem( "Bundle/Build iOS AssetBundle" )]
    static void BuildAssetBundles( )
    {
        var options = BuildAssetBundleOptions.None;

        bool shouldCheckODR = EditorUserBuildSettings.activeBuildTarget == BuildTarget.iOS;

# if UNITY_TVOS
            shouldCheckODR |= EditorUserBuildSettings.activeBuildTarget == BuildTarget.tvOS;
# endif

        if( shouldCheckODR )
        {
# if ENABLE_IOS_ON_DEMAND_RESOURCES
            if( PlayerSettings.iOS.useOnDemandResources )
                options |= BuildAssetBundleOptions.UncompressedAssetBundle;
# endif

# if ENABLE_IOS_APP_SLICING
            options |= BuildAssetBundleOptions.UncompressedAssetBundle;
# endif
        }

        BuildPipeline.BuildAssetBundles( "Assets/ODR", options, EditorUserBuildSettings.activeBuildTarget );
    }

}
</code></pre>

<p>上面代码示例中的重要代码行如下，其中使用带有 <em>textures</em> 标签的文件，并在 Assets/ODR 文件夹中创建名为 <em>textures</em> 的 AssetBundle 文件：</p>

<pre><code>new UnityEditor.iOS.Resource( "textures", "Assets/ODR/textures" ).AddOnDemandResourceTags( "textures" )
</code></pre>

<p>For demonstration purposes, the above code sample also includes the following line, which adds an AssetBundle called <em>bundle</em> that’s already built - for example, from another project or a third-party vendor:</p>

<pre><code>new UnityEditor.iOS.Resource( "bundle", "Assets/Bundles/bundle.unity3d" ).AddOnDemandResourceTags( "bundle" )
</code></pre>

<p>整个代码示例将在 Unity Editor 菜单栏中创建一个新菜单。选择 <strong>Bundle</strong> &gt; <strong>Build iOS AssetBundle</strong>。此时将在 <em>ODR</em> 文件夹中生成 AssetBundles。</p>

<figure>
<img src="../uploads/Main/AppThinning-BuildiOSAssetBundle.png" alt="">
</figure>

<p>The following script downloads the <em>textures</em> ODR AssetBundle, assigning it to the public member <strong>TextureBundle</strong>. Place this somewhere in your project.</p>

<pre><code>using UnityEngine;
using UnityEngine.iOS;
using System;
using System.Collections;

public class LoadBundle : MonoBehaviour
{
    public AssetBundle     TextureBundle;


    void Start( )
    {
        StartCoroutine( LoadAsset( "textures", "textures" ) );
    }

    public IEnumerator LoadAsset( string resourceName, string odrTag )
    {
        // 创建请求
        OnDemandResourcesRequest request = OnDemandResources.PreloadAsync( new string[] { odrTag } );

        // 等待请求完成
        yield return request;

        // 检查是否有错误
        if( request.error != null )
            throw new Exception( "ODR request failed: " + request.error );

        TextureBundle = AssetBundle.LoadFromFile( "res://" + resourceName );

        request.Dispose( );
    }
}
</code></pre>

<p>下一步是生成 Xcode 项目，构建 .IPA，并将其上传到 iTunes Connect 的 TestFlight。在 TestFlight 处理过程中，嵌入式 ODR AssetBundles 将从应用程序中删除并托管在 Apple 的服务器上，可供下载。</p>

<p>在 Xcode 中构建 .IPA 之前，请检查 XCode 的 Build Settings，确保 Assets 部分中的 <strong>Embed Asset packs In Product Bundle</strong> 设置为 <strong>No__，而 </strong>Enable On Demand Resources__ 设置为 <strong>Yes</strong>。</p>

<figure>
<img src="../uploads/Main/AppThinning-XCodeBuildSettings.png" alt="">
</figure>

<p>iTunes Connect 处理完应用程序的上传后，单击 TestFlight Builds 中的构建版本即可查看相关的更多信息：</p>

<figure>
<img src="../uploads/Main/AppThinning-XCodeTestFlightBuilds.png" alt="">
</figure>

<p><a name="AppSlicing"></a></p>

<h2>应用程序切片</h2>

<p>应用程序切片遵循与按需加载资源类似的流程，允许根据运行应用程序的设备的规格动态下载资源（例如，下载用于 Retina iPad 的高分辨率资源，以及用于 iPhone 和 iPad Mini 等小型设备的低分辨率资源）。这是通过定义 AssetBundles 以及添加__变体__配置来实现的。这样可以在启动时决定使用哪种变体，并在下载时自动将其附加到资源文件名。</p>

<p>要创建变体，请单击新文件夹，然后导航到 Inspector 窗口底部的 <strong>Asset Labels</strong> 部分。单击右侧下拉菜单，选择 __New__，然后输入新变体的名称。请注意，AssetBundle 变体必须为小写字母。</p>

<figure>
<img src="../uploads/Main/AppThinning-AssetBundleVariants.png" alt="">
</figure>

<p>必须在 Editor 脚本中引用新变体。要创建 Editor 脚本，请在 Project 窗口中创建一个名为 <em>Editor</em> 的新文件夹。右键单击 Editor 文件夹，然后选择 <strong>Create</strong> &gt; <strong>C# Script</strong>。将新脚本命名为 <strong>BuildiOSAppSlices.cs</strong>。</p>

<p>复制并粘贴下面的代码，将示例标签（“textures”）和变体（“hd”和“sd”）替换为您自己的标签和变体。在此代码示例中，引用了多个文件夹：一个包含 HD 纹理，一个包含 SD 纹理。它们分别被赋予了变体“hd”和“sd”。</p>

<pre><code>using UnityEngine;
using UnityEditor;


public class BuildiOSAppSlices : MonoBehaviour
{
    [InitializeOnLoadMethod]
    static void SetupResourcesBuild( )
    {
        UnityEditor.iOS.BuildPipeline.collectResources += CollectResources;
    }

    static UnityEditor.iOS.Resource[] CollectResources( )
    {
        return new UnityEditor.iOS.Resource[]
        {
            new UnityEditor.iOS.Resource("textures").BindVariant( "Assets/ODR/textures.hd", "hd" )
                                     .BindVariant( "Assets/ODR/textures.sd", "sd" )
                     .AddOnDemandResourceTags( "textures" ),
    };
    }

    [MenuItem( "Bundle/Build iOS App Slices" )]
    static void BuildAssetBundles( )
    {
        var options = BuildAssetBundleOptions.None;

        bool shouldCheckODR = EditorUserBuildSettings.activeBuildTarget == BuildTarget.iOS;

# if UNITY_TVOS
            shouldCheckODR |= EditorUserBuildSettings.activeBuildTarget == BuildTarget.tvOS;
# endif

        if( shouldCheckODR )
        {
# if ENABLE_IOS_ON_DEMAND_RESOURCES
            if( PlayerSettings.iOS.useOnDemandResources )
                options |= BuildAssetBundleOptions.UncompressedAssetBundle;
# endif

# if ENABLE_IOS_APP_SLICING
            options |= BuildAssetBundleOptions.UncompressedAssetBundle;
# endif
        }

        BuildPipeline.BuildAssetBundles( "Assets/ODR", options, EditorUserBuildSettings.activeBuildTarget );
    }

}
</code></pre>

<p>这段代码将在 Unity Editor 菜单栏中创建一个名为 <strong>Bundle</strong> 的新菜单。单击此菜单并选择列表中唯一的菜单项 <strong>Build iOS App Slices</strong>。此时将在 <strong>ODR</strong> 文件夹中生成 AssetBundles。</p>

<p>然后，要加载资源，请将此类放在项目中的某个位置，并传入要加载的变体的名称：</p>

<pre><code>using UnityEngine;
using UnityEngine.iOS;
using System;
using System.Collections;

public class LoadBundle : MonoBehaviour
{
    public AssetBundle     TextureBundle;


    void Start( )
    {
        StartCoroutine( LoadAsset( "textures", "textures" ) );
    }

    public IEnumerator LoadAsset( string resourceName, string odrTag )
    {
        // 创建请求
        OnDemandResourcesRequest request = OnDemandResources.PreloadAsync( new string[] { odrTag } );

        // 等待请求完成
        yield return request;

        // 检查是否有错误
        if( request.error != null )
            throw new Exception( "ODR request failed: " + request.error );

        TextureBundle = AssetBundle.LoadFromFile( "res://" + resourceName );

        request.Dispose( );
    }
}
</code></pre>

<p>You can now see and modify variants in <strong>Player Settings &gt; Other Settings &gt; Configuration</strong> in a <strong>Variant map for app slicing</strong> drop-down menu. The <strong>Variant map for app slicing</strong> menu is visible only if <strong>Use on demand resources</strong> is enabled in Player Settings.</p>

<figure>
<img src="../uploads/Main/AppThinning-VariantMap.png" alt="">
</figure>

<h2>Additional resources:</h2>

<ul>
<li><a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.20/manual/AddressableAssetsMigrationGuide.html">Addressable Assets Migration Guide</a></li>
<li><a href="https://docs.unity3d.com/Packages/com.unity.addressables@1.20/manual/SamplesOverview.html">Addressables samples</a></li>
</ul>
<!-- area:platforms -->
<div id="_content"></div>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="iphone-BuildProcess.html"></a></span><div class="tip">Build for iOS</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="apple-privacy-manifest-policy.html"></a></span><div class="tip">Apple’s privacy manifest policy requirements</div>
</div>
</div>
</div>
<div class="footer-wrapper"><div class="footer clear">
<div class="copy">Copyright © 2022 Unity Technologies. Publication 2022.3</div>
<div class="menu">
<a href="https://learn.unity.com/">教程</a><a href="https://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="https://forum.unity3d.com">论坛</a><a href="https://unity3d.com/asset-store">Asset Store</a><a href="https://docs.unity3d.com/Manual/TermsOfUse.html">商标和使用条款</a><a href="https://unity.com/legal">法律条款</a><a href="https://unity.com/legal/privacy-policy">隐私政策</a><a href="https://unity.com/legal/cookie-policy">Cookie</a><a href="https://unity.com/legal/do-not-sell-my-personal-information">不要出售或分享我的个人信息</a><div id="ot-sdk-btn-container"><a id="ot-sdk-btn" class="ot-sdk-show-settings" href="javascript:void(0);">Your Privacy Choices (Cookie Settings)</a></div>
</div>
</div></div>
</div></div></div>
</div>
</body>
</html>
