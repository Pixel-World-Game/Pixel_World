<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="XR SDK 显示子系统 - Unity 手册">
<title>XR SDK 显示子系统 - Unity 手册</title>
<meta property="og:image" content="https://unity3d.com/files/images/ogimg.jpg">
<meta name="description" content="XR SDK 显示子系统为纹理分配、帧生命周期和节奏阻止提供了一个接口。">
<meta property="og:description" content="XR SDK 显示子系统为纹理分配、帧生命周期和节奏阻止提供了一个接口。">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836" data-dLayer-ignore="true" data-document-language="true"></script><script type="text/javascript">function OptanonWrapper() {}</script><script>window.dataLayer = window.dataLayer || []; dataLayer.push({ event: 'dataLayer-initialized', user: { user_unity_id: undefined, user_logged_in: 'no' }, environment: { environment_locale: '', environment_currency: undefined }});</script><script>var offline=(location.href.indexOf('docs.unity3d.com')==-1)?true:false;if(!offline){(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=   'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);  })(window,document,'script','dataLayer','GTM-5V25JL6');}</script><script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'xrsdk-display';
      if(!page) page = 'index';
      var version = '2022.3';
      var docs_versions = [{version: '2023.2',version_string: '2023.2',supported: true},{version: '2023.1',version_string: '2023.1',supported: false},{version: '2022.3',version_string: '2022.3',supported: true},{version: '2022.2',version_string: '2022.2',supported: false},{version: '2022.1',version_string: '2022.1',supported: false},{version: '2021.3',version_string: '2021.3',supported: true},{version: '2021.2',version_string: '2021.2',supported: false},{version: '2021.1',version_string: '2021.1',supported: false},{version: '2020.3',version_string: '2020.3',supported: false},{version: '2020.2',version_string: '2020.2',supported: false},{version: '2020.1',version_string: '2020.1',supported: false},{version: '2019.4',version_string: '2019.4',supported: false},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: false},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><script src="/StaticFilesConfig/feedback/feedback.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/2022.3/Manual/xrsdk-display.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2022.3/Manual/xrsdk-display.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/cn/2022.3/Manual/xrsdk-display.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity3d.com/ja/2022.3/Manual/xrsdk-display.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/kr/2022.3/Manual/xrsdk-display.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/2022.3/Documentation/Manual/xrsdk-display.html" hreflang="x-default">
</head>
<body>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2022.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2023.2" href="/cn/2023.2/Manual/xrsdk-display.html">2023.2</a></li>
<li class=""><a class="docs_version_url_2023.1" href="/cn/2023.1/Manual/xrsdk-display.html">2023.1</a></li>
<li class="supported"><a class="docs_version_url_2022.3" href="/cn/2022.3/Manual/xrsdk-display.html">2022.3</a></li>
<li class=""><a class="docs_version_url_2022.2" href="/cn/2022.2/Manual/xrsdk-display.html">2022.2</a></li>
<li class=""><a class="docs_version_url_2022.1" href="/cn/2022.1/Manual/xrsdk-display.html">2022.1</a></li>
<li class="supported"><a class="docs_version_url_2021.3" href="/cn/2021.3/Manual/xrsdk-display.html">2021.3</a></li>
<li class=""><a class="docs_version_url_2021.2" href="/cn/2021.2/Manual/xrsdk-display.html">2021.2</a></li>
<li class=""><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/xrsdk-display.html">2021.1</a></li>
<li class=""><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/xrsdk-display.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/xrsdk-display.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/xrsdk-display.html">2020.1</a></li>
<li class=""><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/xrsdk-display.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/xrsdk-display.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/xrsdk-display.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/xrsdk-display.html">2019.1</a></li>
<li class=""><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/xrsdk-display.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/xrsdk-display.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/xrsdk-display.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/xrsdk-display.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/xrsdk-display.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/xrsdk-display.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/xrsdk-display.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/xrsdk-display.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/xrsdk-display.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2022.3/Documentation/Manual/xrsdk-display.html">English</a></li>
<li><a data-lang="cn" href="/cn/2022.3/Manual/xrsdk-display.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2022.3/Manual/xrsdk-display.html">日本語</a></li>
<li><a data-lang="kr" href="/kr/2022.3/Manual/xrsdk-display.html">한국어</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2022.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2023.2" href="/cn/2023.2/Manual/xrsdk-display.html">2023.2</a></li>
<li class=""><a class="docs_version_url_2023.1" href="/cn/2023.1/Manual/xrsdk-display.html">2023.1</a></li>
<li class="supported"><a class="docs_version_url_2022.3" href="/cn/2022.3/Manual/xrsdk-display.html">2022.3</a></li>
<li class=""><a class="docs_version_url_2022.2" href="/cn/2022.2/Manual/xrsdk-display.html">2022.2</a></li>
<li class=""><a class="docs_version_url_2022.1" href="/cn/2022.1/Manual/xrsdk-display.html">2022.1</a></li>
<li class="supported"><a class="docs_version_url_2021.3" href="/cn/2021.3/Manual/xrsdk-display.html">2021.3</a></li>
<li class=""><a class="docs_version_url_2021.2" href="/cn/2021.2/Manual/xrsdk-display.html">2021.2</a></li>
<li class=""><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/xrsdk-display.html">2021.1</a></li>
<li class=""><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/xrsdk-display.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/xrsdk-display.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/xrsdk-display.html">2020.1</a></li>
<li class=""><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/xrsdk-display.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/xrsdk-display.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/xrsdk-display.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/xrsdk-display.html">2019.1</a></li>
<li class=""><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/xrsdk-display.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/xrsdk-display.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/xrsdk-display.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/xrsdk-display.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/xrsdk-display.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/xrsdk-display.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/xrsdk-display.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/xrsdk-display.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/xrsdk-display.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual 2022.3 (LTS)</a></li>
<li><a href="XR.html">XR</a></li>
<li><a href="xr-sdk.html">Unity XR SDK</a></li>
<li>Subsystems</li>
<li>XR SDK 显示子系统</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="xrsdk-input.html"></a></span><div class="tip">XR SDK 输入子系统</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="xrsdk-meshing.html"></a></span><div class="tip">XR SDK 网格子系统</div>
</div>
</div></div>
<h1>XR SDK 显示子系统</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>XR SDK 显示子系统为纹理分配、帧生命周期和节奏阻止提供了一个接口。</p>

<h2>纹理分配</h2>

<p>一些设备 SDK 要求通过 SDK 本身（而不是通常的图形 API）分配纹理。如果使用 XR SDK 显示子系统，则不再需要依赖外部插件来 blit 或复制到 SDK 纹理中。</p>

<p>显示子系统使插件提供程序可以分配纹理。在可能的情况下，Unity 会直接渲染到纹理以避免不必要的副本。如果需要，Unity 也可以为您分配纹理。</p>

<p>在以下情况下，Unity 无法直接渲染到纹理，而是渲染到中间纹理，然后 blit 或复制到您的纹理：</p>

<ul>
<li>如果在使用图像效果，则您的纹理将处于链中的最后位置。</li>
<li>在带有 MSAA 的 PC 上，Unity 会渲染到多重采样纹理，然后在摄像机堆栈的末尾处解析为您的纹理。</li>
<li>在移动设备上，借助多重采样自动解析扩展，当纹理进行刷新或用作任何操作（除绘制到它之外）的源或目标时，纹理会进行隐式解析。请参阅 <code>EXT_multisampled_render_to_texture</code> 扩展。</li>
<li>延迟渲染、HDR 和命令缓冲区会导致 Unity 渲染到中间纹理。</li>
<li>如果渲染到屏幕的子集，则 Unity 会渲染到中间纹理。</li>
<li>如果“纹理布局”与 Unity 渲染到的内容不匹配（例如，Unity 将每只眼睛渲染到单独的纹理，但 RenderPass 配置为渲染到纹理数组或单一纹理）。</li>
<li>如果设置了 <code>kUnityXRRenderTextureFlagsLockedWidthHeight</code> 标志并且 renderScale 不是 1.0。</li>
<li>如果设置了 <code>kUnityXRRenderTextureFlagsWriteOnly</code> 标志并且 Unity 需要从纹理读回。</li>
</ul>

<h3>MSAA</h3>

<p>在 PC 和移动设备上，引擎始终解析为提供程序的纹理。引擎执行隐式解析（在进行多重采样渲染到纹理扩展的移动设备上）或显式解析。</p>

<p>在移动设备上，提供程序应启用 <code>kUnityXRRenderTextureFlagsAutoResolve</code> 标志并使用 1 个样本创建其纹理。</p>

<h3>sRGB</h3>

<p>使用 <code>UnityXRFrameSetupHints.appSetup.sRGB</code> 可检查 Unity 是否期望渲染到 sRGB 纹理格式。提供程序最终从 <code>UnityXRRenderTextureDesc</code> 的 <code>colorFormat</code> 字段选择输出纹理格式。如果格式是 sRGB 类型，则 Unity 会根据活动项目选择的颜色空间打开或关闭 sRGB 写入。您应该始终在合成器中使用 sRGB 到线性转换从任何 sRGB 纹理进行采样。</p>

<h3>深度纹理</h3>

<p>如果 SDK 需要深度信息，则可以通过与上述颜色缓冲区相同的方式获取深度缓冲区。<code>UnityXRRenderTextureDesc</code> 上的 <code>nativeDepthTex</code> 值指定原生资源。默认情况下，如果 <code>nativeDepthTex</code> 设置为 <code>kUnityXRRenderTextureIdDontCare</code>，则 Unity 会尝试在具有相似描述的纹理之间共享深度缓冲区。</p>

<p>如果 SDK 不需要深度信息，则应该将 <code>UnityXRRenderTextureDesc::depthFormat</code> 设置为 <code>kUnityXRDepthTextureFormatNone</code> 以避免不必要的解析。</p>

<h3>处理双缓冲和三缓冲</h3>

<p>在提交期间（请参阅下面的<a href="#submitting-frames-in-flight">提交在途帧</a>部分），您可以每一帧指定不同的纹理 ID，以便处理 SDK 需要 Unity 渲染到的双缓冲或三缓冲图像的情况。提供程序插件负责管理 <code>UnityXRRenderTextureId</code> 的集合。</p>

<h2>帧生命周期</h2>

<p>有两种方法负责帧的生命周期：<code>PopulateNextFrameDesc</code>（就在渲染开始之前发生）和 <code>SubmitCurrentFrame</code>（在渲染完成后立即发生）。这两种方法都在图形线程上进行调用。</p>

<p>在 <code>PopulateNextFrameDesc</code> 期间，显示提供程序预期会执行以下操作：</p>

<ul>
<li>等待节奏（等到 Unity 应该再次开始提交渲染命令）。或者，这可以在 <code>SubmitCurrentFrame</code> 中完成。</li>
<li>获取下一个图像并通过 <code>nextFrame</code> 参数向 Unity 告知下一个要渲染的纹理 ID。</li>
</ul>

<p>在 <code>SubmitCurrentFrame</code> 方法期间，显示提供程序预期会执行以下操作：</p>

<ul>
<li>提交在途的最后一帧（例如，眼睛纹理或深度纹理）以显示在屏幕上。</li>
<li>等待节奏，作为在 <code>PopulateNextFrameDesc</code> 期间等待的替代方法。</li>
</ul>

<h3>阻止节奏</h3>

<p>要在渲染到 HMD 显示器时保持尽可能低的延迟和最大吞吐量，需要在获取姿势和提交纹理时确保精确定时。每个 HMD 都具有其合成器运行时所采用的原生刷新率。由于不匹配的定时或冗余工作，渲染速度超过该刷新率会导致体验不是最佳。</p>

<p>Unity expects the display provider to block, or wait for frame cadence, during the frame lifecycle. Unity starts submitting rendering commands shortly after ‘waking up’ from the blocking call. You should synchronize the wake-up time to your compositor within a particular window. Some SDKs provide a floating wake-up time window based on heuristics. Meta/Oculus calls this the “queue ahead” (see <a href="https://developer.oculus.com/documentation/pcsdk/latest/concepts/dg-render/?locale=en_US#adaptive-queue-ahead">Oculus developer documentation</a> for more information). Valve calls it “running start” (see slides 18 and 19 of <a href="http://media.steampowered.com/apps/valve/2015/Alex_Vlachos_Advanced_VR_Rendering_GDC2015.pdf">this presentation</a>).</p>

<p>Unity 在开始提交与姿势相关的图形命令之前会等待帧生命周期完成。</p>

<h4>在何处等待节奏</h4>

<p>提供程序可以在 <code>PopulateNextFrameDesc</code> 或 <code>SubmitCurrentFrame</code> 中等待节奏。</p>

<p>当 Unity 在图形线程中为某一帧提交图形命令时，下一帧的模拟循环在主线程上运行。它包含物理、脚本逻辑等。在提交所有渲染命令后，并且只有在下一帧的模拟以及在其中安排的所有图形作业完成后，才在图形线程上调用 <code>PopulateNextFrameDesc</code>。<code>PopulateNextFrameDesc</code> 等待的图形作业之一是当前帧的 <code>SubmitCurrentFrame</code>。这便是为何在 <code>SubmitCurrentFrame</code> 中等待节奏是有效的。此外，在 <code>PopulateNextFrameDesc</code> 完成之前，Unity 不会开始渲染。</p>

<p>考虑到这些细节，在 <code>SubmitCurrentFrame</code> 而不是 <code>PopulateNextFrameDesc</code> 中等待节奏需进行一些取舍。例如，如果应用程序在模拟期间安排成本昂贵的图形作业，则在 <code>SubmitCurrentFrame</code> 中等待节奏可能会导致性能问题。因为 <code>SubmitCurrentFrame</code> 安排为在渲染之后运行，应用程序安排的图形作业将在 <code>SubmitCurrentFrame</code> 之后运行，但在 <code>PopulateNextFrameDesc</code> 之前运行。在这种情况下，提供程序在 <code>SubmitCurrentFrame</code> 中进行等待，然后它会唤醒，期望 Unity 开始渲染。但是，Unity 会在调用 <code>PopulateNextFrameDesc</code> 之前处理应用程序安排的图形作业，这进而使 Unity 可以开始渲染。唤醒渲染和处理更新方法中安排的图形作业之间的这种延时可能会导致延迟。开发者可以安排其图形作业在<a href="../ScriptReference/MonoBehaviour.OnPostRender.html">渲染后</a>运行，以确保在 <code>SubmitCurrentFrame</code> 之前安排图形作业，从而优化此方面。</p>

<p>虽然提供程序在 <code>SubmitCurrentFrame</code> 中等待节奏使计算图形作业可以与主线程并行运行，但在 <code>PopulateNextFrameDesc</code> 中等待节奏会完全阻止 Unity 主线程。这是可以接受的，因为模拟和其他图形作业已完成。当模拟或图形线程占用太多时间并超过设备的目标帧速率时，可能会发生问题。这可能会导致帧速率减半，同时 <code>PopulateNextFrameDesc</code> 等待节奏中的下一个周期。</p>

<p><a id="submitting-frames-in-flight"></a></p>

<h3>提交在途帧</h3>

<p>Unity 调用 <code>SubmitCurrentFrame</code> 时，您在最后一帧设置的纹理已进行渲染，或者 Unity 已向图形驱动程序提交了渲染命令来渲染它们。Unity 现在已完成了它们，您可以将它们传递给合成器。</p>

<h3>填写下一帧描述符</h3>

<p>在阻止或获取要渲染的下一帧之后，您必须向 Unity 告知在下一帧中要渲染到的纹理，以及渲染通道的布局（请参阅下面的渲染通道）。</p>

<h4>渲染通道</h4>

<p><code>UnityXRRenderPass</code> 可能涉及一个剔除通道和一次场景图遍历。这是资源密集型操作，您应该尝试通过单通道渲染等技巧来限制 Unity 执行它的次数。</p>

<p>每个 <code>UnityXRRenderPass</code> 都包含（一个输出纹理（可以是纹理数组），并输出<code>UnityXRRenderParams</code>（例如视图、投影矩阵和要渲染到的矩形或纹理数组切片）。</p>

<p>对于每一帧，显示提供程序都会设置一个 <code>UnityXRRenderTextureId</code> 并填写 Unity 将在下一帧渲染到 <code>UnityXRRenderTextureId</code>。</p>

<p><code>UnityXRRenderPass</code> 的用例包括以下内容：</p>

<ul>
<li>两通道立体渲染 (2 RenderPass x 1 RenderParams)</li>
<li>Single-pass stereo rendering (1 RenderPass x 2 RenderParams)</li>
</ul>

<p>API 支持这些附加情况（但 Unity 现在可能无法正确响应）：</p>

<ul>
<li>四通道宽 FOV 立体渲染 (4 RenderPass x 1 RenderParams)</li>
<li>Single-pass + wide FOV stereo rendering (1 RenderPass x 2 RenderParams + 2 RenderPass x 1 RenderParams)</li>
<li>注视点渲染：

<ul>
<li>每只眼睛有两个单独纹理（内部和外部）</li>
<li>一种纹理，适用于 UV</li>
</ul>
</li>
<li>外部视图方案（HoloLens BEV，Mayo 3rd eye）（额外 RenderPass）</li>
<li>用于在场景中合成物体或人物的远/近渲染（2 RenderPass，不同的投影，不同的目标）</li>
</ul>

<p>做出这些假设是安全的：</p>

<ul>
<li>每个通道一个纹理（单传递是一个纹理数组）</li>
<li>如果为单通道，则每个通道两个姿势/投影（或是注视点渲染）</li>
</ul>

<p><strong>注意：</strong>Unity 项目和 XR SDK 必须使用相同的设置（启用/禁用）来用于单通道渲染，因为此设置会影响用户着色器。要检查是否启用了单通道渲染，请使用 <code>UnityXRFrameSetupHints.appSetup.singlePassRendering</code>。</p>

<h4>剔除通道</h4>

<p>如果 <code>cullingPassIndex</code> 设置为相同的值，则两个渲染通道可以共享一个剔除通道。<code>cullingPassIndex</code> 选择要使用的 <code>UnityXRCullingPass</code>。剔除通道必须在 <code>UnityXRNextFrameDesc</code> 中填写。</p>
<div id="_content"></div>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="xrsdk-input.html"></a></span><div class="tip">XR SDK 输入子系统</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="xrsdk-meshing.html"></a></span><div class="tip">XR SDK 网格子系统</div>
</div>
</div>
</div>
<div class="footer-wrapper"><div class="footer clear">
<div class="copy">Copyright © 2022 Unity Technologies. Publication 2022.3</div>
<div class="menu">
<a href="https://learn.unity.com/">教程</a><a href="https://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="https://forum.unity3d.com">论坛</a><a href="https://unity3d.com/asset-store">Asset Store</a><a href="https://docs.unity3d.com/Manual/TermsOfUse.html">商标和使用条款</a><a href="https://unity.com/legal">法律条款</a><a href="https://unity.com/legal/privacy-policy">隐私政策</a><a href="https://unity.com/legal/cookie-policy">Cookie</a><a href="https://unity.com/legal/do-not-sell-my-personal-information">不要出售或分享我的个人信息</a><div id="ot-sdk-btn-container"><a id="ot-sdk-btn" class="ot-sdk-show-settings" href="javascript:void(0);">Your Privacy Choices (Cookie Settings)</a></div>
</div>
</div></div>
</div></div></div>
</div>
</body>
</html>
