<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="内置宏 - Unity 手册">
<title>内置宏 - Unity 手册</title>
<meta property="og:image" content="https://unity3d.com/files/images/ogimg.jpg">
<meta name="description" content="Unity 在编译着色器程序时会定义几个预处理器宏。">
<meta property="og:description" content="Unity 在编译着色器程序时会定义几个预处理器宏。">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836" data-dLayer-ignore="true" data-document-language="true"></script><script type="text/javascript">function OptanonWrapper() {}</script><script>window.dataLayer = window.dataLayer || []; dataLayer.push({ event: 'dataLayer-initialized', user: { user_unity_id: undefined, user_logged_in: 'no' }, environment: { environment_locale: '', environment_currency: undefined }});</script><script>var offline=(location.href.indexOf('docs.unity3d.com')==-1)?true:false;if(!offline){(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=   'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);  })(window,document,'script','dataLayer','GTM-5V25JL6');}</script><script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'SL-BuiltinMacros';
      if(!page) page = 'index';
      var version = '2022.3';
      var docs_versions = [{version: '2023.2',version_string: '2023.2',supported: true},{version: '2023.1',version_string: '2023.1',supported: false},{version: '2022.3',version_string: '2022.3',supported: true},{version: '2022.2',version_string: '2022.2',supported: false},{version: '2022.1',version_string: '2022.1',supported: false},{version: '2021.3',version_string: '2021.3',supported: true},{version: '2021.2',version_string: '2021.2',supported: false},{version: '2021.1',version_string: '2021.1',supported: false},{version: '2020.3',version_string: '2020.3',supported: false},{version: '2020.2',version_string: '2020.2',supported: false},{version: '2020.1',version_string: '2020.1',supported: false},{version: '2019.4',version_string: '2019.4',supported: false},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: false},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><script src="/StaticFilesConfig/feedback/feedback.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/2022.3/Manual/SL-BuiltinMacros.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2022.3/Manual/SL-BuiltinMacros.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/cn/2022.3/Manual/SL-BuiltinMacros.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity3d.com/ja/2022.3/Manual/SL-BuiltinMacros.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/kr/2022.3/Manual/SL-BuiltinMacros.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/2022.3/Documentation/Manual/SL-BuiltinMacros.html" hreflang="x-default">
</head>
<body>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2022.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2023.2" href="/cn/2023.2/Manual/SL-BuiltinMacros.html">2023.2</a></li>
<li class=""><a class="docs_version_url_2023.1" href="/cn/2023.1/Manual/SL-BuiltinMacros.html">2023.1</a></li>
<li class="supported"><a class="docs_version_url_2022.3" href="/cn/2022.3/Manual/SL-BuiltinMacros.html">2022.3</a></li>
<li class=""><a class="docs_version_url_2022.2" href="/cn/2022.2/Manual/SL-BuiltinMacros.html">2022.2</a></li>
<li class=""><a class="docs_version_url_2022.1" href="/cn/2022.1/Manual/SL-BuiltinMacros.html">2022.1</a></li>
<li class="supported"><a class="docs_version_url_2021.3" href="/cn/2021.3/Manual/SL-BuiltinMacros.html">2021.3</a></li>
<li class=""><a class="docs_version_url_2021.2" href="/cn/2021.2/Manual/SL-BuiltinMacros.html">2021.2</a></li>
<li class=""><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/SL-BuiltinMacros.html">2021.1</a></li>
<li class=""><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/SL-BuiltinMacros.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/SL-BuiltinMacros.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/SL-BuiltinMacros.html">2020.1</a></li>
<li class=""><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/SL-BuiltinMacros.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/SL-BuiltinMacros.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/SL-BuiltinMacros.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/SL-BuiltinMacros.html">2019.1</a></li>
<li class=""><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/SL-BuiltinMacros.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/SL-BuiltinMacros.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/SL-BuiltinMacros.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/SL-BuiltinMacros.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/SL-BuiltinMacros.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/SL-BuiltinMacros.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/SL-BuiltinMacros.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/SL-BuiltinMacros.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/SL-BuiltinMacros.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2022.3/Documentation/Manual/SL-BuiltinMacros.html">English</a></li>
<li><a data-lang="cn" href="/cn/2022.3/Manual/SL-BuiltinMacros.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2022.3/Manual/SL-BuiltinMacros.html">日本語</a></li>
<li><a data-lang="kr" href="/kr/2022.3/Manual/SL-BuiltinMacros.html">한국어</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2022.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2023.2" href="/cn/2023.2/Manual/SL-BuiltinMacros.html">2023.2</a></li>
<li class=""><a class="docs_version_url_2023.1" href="/cn/2023.1/Manual/SL-BuiltinMacros.html">2023.1</a></li>
<li class="supported"><a class="docs_version_url_2022.3" href="/cn/2022.3/Manual/SL-BuiltinMacros.html">2022.3</a></li>
<li class=""><a class="docs_version_url_2022.2" href="/cn/2022.2/Manual/SL-BuiltinMacros.html">2022.2</a></li>
<li class=""><a class="docs_version_url_2022.1" href="/cn/2022.1/Manual/SL-BuiltinMacros.html">2022.1</a></li>
<li class="supported"><a class="docs_version_url_2021.3" href="/cn/2021.3/Manual/SL-BuiltinMacros.html">2021.3</a></li>
<li class=""><a class="docs_version_url_2021.2" href="/cn/2021.2/Manual/SL-BuiltinMacros.html">2021.2</a></li>
<li class=""><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/SL-BuiltinMacros.html">2021.1</a></li>
<li class=""><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/SL-BuiltinMacros.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/SL-BuiltinMacros.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/SL-BuiltinMacros.html">2020.1</a></li>
<li class=""><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/SL-BuiltinMacros.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/SL-BuiltinMacros.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/SL-BuiltinMacros.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/SL-BuiltinMacros.html">2019.1</a></li>
<li class=""><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/SL-BuiltinMacros.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/SL-BuiltinMacros.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/SL-BuiltinMacros.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/SL-BuiltinMacros.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/SL-BuiltinMacros.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/SL-BuiltinMacros.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/SL-BuiltinMacros.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/SL-BuiltinMacros.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/SL-BuiltinMacros.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual 2022.3 (LTS)</a></li>
<li><a href="Graphics.html">图形</a></li>
<li><a href="Shaders.html">着色器</a></li>
<li><a href="shader-writing.html">编写着色器</a></li>
<li><a href="SL-ShaderPrograms.html">Unity 中的 HLSL</a></li>
<li>内置宏</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="SL-BuiltinIncludes.html"></a></span><div class="tip">内置着色器 include 文件</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="SL-BuiltinFunctions.html"></a></span><div class="tip">内置着色器 helper 函数</div>
</div>
</div></div>
<h1>内置宏</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>Unity 在编译<a href="SL-ShaderPrograms.html">着色器程序</a>时会定义几个预处理器宏。</p>

<h2>目标平台</h2>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;"><strong>宏：</strong></th>
	<th style="text-align:left;"><strong>目标平台：</strong></th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;"><code>SHADER_API_D3D11</code></td>
	<td style="text-align:left;">Direct3D 11</td>
</tr>
<tr>
	<td style="text-align:left;"><code>SHADER_API_GLCORE</code></td>
	<td style="text-align:left;">桌面端 OpenGL“核心”(GL 3/4)</td>
</tr>
<tr>
	<td style="text-align:left;"><code>SHADER_API_GLES</code></td>
	<td style="text-align:left;">OpenGL ES 2.0</td>
</tr>
<tr>
	<td style="text-align:left;"><code>SHADER_API_GLES3</code></td>
	<td style="text-align:left;">OpenGL ES 3.0/3.1</td>
</tr>
<tr>
	<td style="text-align:left;"><code>SHADER_API_METAL</code></td>
	<td style="text-align:left;">iOS/Mac Metal</td>
</tr>
<tr>
	<td style="text-align:left;"><code>SHADER_API_VULKAN</code></td>
	<td style="text-align:left;">Vulkan</td>
</tr>
<tr>
	<td style="text-align:left;"><code>SHADER_API_D3D11_9X</code></td>
	<td style="text-align:left;">适用于通用 Windows 平台的 Direct3D 11“功能级别 9.x”目标</td>
</tr>
<tr>
	<td style="text-align:left;"><code>SHADER_API_DESKTOP</code></td>
	<td style="text-align:left;">Windows, Mac and Linux desktop platforms, WebGL, Stadia</td>
</tr>
<tr>
	<td style="text-align:left;"><code>SHADER_API_MOBILE</code></td>
	<td style="text-align:left;">iOS and Android mobile platforms, tvOS</td>
</tr>
</tbody>
</table>

<p>此外，当目标着色语言为 GLSL 时，还会定义 <code>SHADER_TARGET_GLSL</code>（对于 OpenGL/GLES 平台来说始终会定义）。</p>

<h2>着色器目标模型</h2>

<p><code>SHADER_TARGET</code> 被定义为与着色器目标编译模型匹配的数值（即匹配 <code>#pragma target</code> 指令）。例如，当编译到着色器模型 3.0 时，<code>SHADER_TARGET</code> 为 <code>30</code>。您可以在着色器代码中使用此宏来进行条件检查。例如：</p>

<pre><code># if SHADER_TARGET &lt; 30
    // 低于着色器模型 3.0：
    // 着色器功能非常有限，执行近似操作
# else
    // 不错的功能，执行更高级的任务
# endif
</code></pre>

<h2>Unity 版本</h2>

<p><code>UNITY_VERSION</code> contains the numeric value of the Unity version. For example, <code>UNITY_VERSION</code> is <code>202030</code> for Unity 2020.3.0. This can be used for version comparisons if you need to write Shaders that use different built-in Shader functionality. For example, a <code>#if UNITY_VERSION &gt;= 202000</code> preprocessor check only passes on versions 2020 or later.</p>

<h2>编译的着色器阶段</h2>

<p>编译每个着色器阶段时会定义预处理器宏 <code>SHADER_STAGE_VERTEX</code>、<code>SHADER_STAGE_FRAGMENT</code>、<code>SHADER_STAGE_DOMAIN</code>、<code>SHADER_STAGE_HULL</code>、<code>SHADER_STAGE_GEOMETRY</code> 或 <code>SHADER_STAGE_COMPUTE</code>。通常，在像素着色器和计算着色器之间共享着色器代码时，这些宏非常有用，可以解决某些工作必须以略有不同的方式来完成的情况。</p>

<h2>平台差异 helper</h2>

<p>不鼓励直接使用这些平台宏，因为它们并非始终有助于代码的未来验证。例如，如果您正在编写一个检查 D3D11 的着色器，您可能希望确保在将来将这项检查扩展为包含 Vulkan。应改用 Unity 定义的几个 helper 宏（在 <a href="SL-BuiltinIncludes.html"><code>HLSLSupport.cginc</code></a> 中）：</p>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;"><strong>宏：</strong></th>
	<th style="text-align:left;"><strong>用途：</strong></th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;"><code>UNITY_BRANCH</code></td>
	<td style="text-align:left;">在条件语句之前添加此宏，告知编译器应将其编译为实际分支。在 HLSL 平台上扩展为 <code>[branch]</code>。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_FLATTEN</code></td>
	<td style="text-align:left;">在条件语句之前添加此宏，告知编译器应该将其展平以避免实际的分支指令。在 HLSL 平台上扩展为 <code>[flatten]</code>。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_NO_SCREENSPACE_SHADOWS</code></td>
	<td style="text-align:left;">在不使用级联屏幕空间阴影贴图的平台（移动平台）上定义。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_NO_LINEAR_COLORSPACE</code></td>
	<td style="text-align:left;">在不支持线性颜色空间的平台（移动平台）上定义。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_NO_RGBM</code></td>
	<td style="text-align:left;">在不使用光照贴图 RGBM 压缩的平台（移动平台）上定义。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_NO_DXT5nm</code></td>
	<td style="text-align:left;">在不使用 DXT5nm 法线贴图压缩的平台（移动平台）上定义。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_FRAMEBUFFER_FETCH_AVAILABLE</code></td>
	<td style="text-align:left;">在可使用“帧缓冲颜色提取”功能的平台（通常为 iOS 平台 - OpenGL ES 2.0、3.0 和 Metal）上定义。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_USE_RGBA_FOR_POINT_SHADOWS</code></td>
	<td style="text-align:left;">在点光源阴影贴图使用具有编码深度的 RGBA 纹理的平台（其他平台使用单通道浮点纹理）上定义。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_ATTEN_CHANNEL</code></td>
	<td style="text-align:left;">定义光源衰减纹理的哪个通道包含数据；用于每像素光照代码。定义为“r”或“a”。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_HALF_TEXEL_OFFSET</code></td>
	<td style="text-align:left;">Defined on platforms that need a half-texel offset adjustment in mapping texels to pixels.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_UV_STARTS_AT_TOP</code></td>
	<td style="text-align:left;">始终定义值为 1 或 0。值为 1 表示在平台上的纹理之上的纹理 V 坐标为 0。Direct3D 类平台使用值 1；OpenGL 类平台使用值 0。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_MIGHT_NOT_HAVE_DEPTH_Texture</code></td>
	<td style="text-align:left;">如果平台可以通过手动将深度渲染到纹理中来模拟阴影贴图或深度纹理，则定义此宏。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_PROJ_COORD(a)</code></td>
	<td style="text-align:left;">给定一个 4 分量矢量，此宏返回一个适合投影纹理读取的纹理坐标。在大多数平台上，它直接返回给定值。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_NEAR_CLIP_VALUE</code></td>
	<td style="text-align:left;">Defined to the value of near clipping plane. Direct3D-like platforms use 1.0 while OpenGL-like platforms use –1.0.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_VPOS_TYPE</code></td>
	<td style="text-align:left;">定义像素位置输入 (VPOS) 所需的数据类型：D3D9 上为 <code>float2</code>，其他为 <code>float4</code>。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_CAN_COMPILE_TESSELLATION</code></td>
	<td style="text-align:left;">在着色器编译器“理解”曲面细分着色器 HLSL 语法时定义（当前仅限 D3D11）。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_INITIALIZE_OUTPUT(type,name)</code></td>
	<td style="text-align:left;">将给定_类型_的变量_名称_初始化为零。</td>
</tr>
<tr>
	<td style="text-align:left;">
<code>UNITY_COMPILER_HLSL</code>, <code>UNITY_COMPILER_HLSL2GLSL</code>, <code>UNITY_COMPILER_CG</code>
</td>
	<td style="text-align:left;">指示正在使用哪个着色器编译器来编译着色器。有关更多详细信息，请参阅有关<a href="shader-compilation.html">着色器编译</a>的文档。如果遇到编译器之间有非常具体的着色器语法处理差异，并希望为每个编译器编写不同的代码，请使用此宏。</td>
</tr>
</tbody>
</table>

<ul>
<li>
<code>UNITY_REVERSED_Z</code> - 在使用反转 Z 缓冲区的平台上定义。存储的 Z 值的范围是 1 到 0，而不是 0 到 1。</li>
</ul>

<h2>阴影贴图宏</h2>

<p>根据平台的不同，声明和采样阴影贴图可能会有很大差异。Unity 有几个宏可帮助解决这个问题：</p>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;"><strong>宏：</strong></th>
	<th style="text-align:left;"><strong>用途：</strong></th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;"><code>UNITY_DECLARE_SHADOWMAP(tex)</code></td>
	<td style="text-align:left;">声明一个名为“tex”的阴影贴图纹理变量。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_SAMPLE_SHADOW(tex,uv)</code></td>
	<td style="text-align:left;">在给定的“uv”坐标处采样阴影贴图纹理“tex”（XY 分量是纹理位置，Z 分量是要比较的深度）。返回单个浮点值，阴影项的范围在 0 到 1 之间。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_SAMPLE_SHADOW_PROJ(tex,uv)</code></td>
	<td style="text-align:left;">与上面类似，但是会读取投影阴影贴图。“uv”是一个 float4，所有其他分量除以 .w 来执行查找。</td>
</tr>
</tbody>
</table>

<p><strong>注意：</strong>并非所有显卡都支持阴影贴图。请使用 <a href="../ScriptReference/SystemInfo.SupportsRenderTextureFormat.html">SystemInfo.SupportsRenderTextureFormat</a> 检查是否支持。</p>

<p><a name="cbuffer"></a></p>

<h2>常量缓冲区宏</h2>

<p>Direct3D 11 将所有着色器变量分组为“常量缓冲区”。Unity 的大多数内置变量已经分组，但对于您自己的着色器中的变量，更加理想的做法是，根据预期的更新频率将它们放入单独的常量缓冲区。</p>

<p>对此，请使用 <code>CBUFFER_START(name)</code> 和 <code>CBUFFER_END</code> 宏：</p>

<pre><code>CBUFFER_START(MyRarelyUpdatedVariables)
    float4 _SomeGlobalValue;
CBUFFER_END
</code></pre>

<p>If you use a GPU <a href="../ScriptReference/ComputeBuffer.html">compute buffer</a> or <a href="../ScriptReference/GraphicsBuffer.html">graphics buffer</a> to set the value of the variables, make sure the buffer and the constant buffer have matching data layouts on all graphics APIs you build for. See <a href="SL-PlatformDifferences.html#cbuffers">Using constant buffers with GPU buffers</a> for more information.</p>

<h2>纹理/采样器声明宏</h2>

<p>通常，在着色器代码中使用 <code>texture2D</code> 来声明纹理和采样器对。
但是在某些平台（例如 DX11）上，纹理和采样器是单独的对象，
并且可能的采样器最大数量非常有限。Unity 有一些宏来声明
没有采样器的纹理，并使用另一个纹理中的采样器对纹理进行采样。
如果您遇到采样器限制，并且知道几个纹理实际上可以共享同一个采样器
（采样器定义纹理过滤和包裹模式），请使用这些宏。</p>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;"><strong>宏：</strong></th>
	<th style="text-align:left;"><strong>用途：</strong></th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;"><code>UNITY_DECLARE_TEX2D(name)</code></td>
	<td style="text-align:left;">声明纹理和采样器对。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_DECLARE_TEX2D_NOSAMPLER(name)</code></td>
	<td style="text-align:left;">声明不含采样器的纹理。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_DECLARE_TEX2DARRAY(name)</code></td>
	<td style="text-align:left;">声明纹理数组采样器变量。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_SAMPLE_TEX2D(name,uv)</code></td>
	<td style="text-align:left;">使用给定的纹理坐标从纹理和采样器对中采样。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_SAMPLE_TEX2D_SAMPLER( name,samplername,uv)</code></td>
	<td style="text-align:left;">使用另一个纹理中的采样器 (samplername)，从纹理 (name) 中采样。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_SAMPLE_TEX2DARRAY(name,uv)</code></td>
	<td style="text-align:left;">从具有 float3 UV 的纹理数组中采样；坐标的 z 分量是数组元素索引。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_SAMPLE_TEX2DARRAY_LOD(name,uv,lod)</code></td>
	<td style="text-align:left;">从具有显式 Mipmap 级别的纹理数组中采样。</td>
</tr>
</tbody>
</table>

<p>有关更多信息，请参阅<a href="SL-SamplerStates.html">采样器状态</a>文档。</p>

<h2>表面着色器通道指示符</h2>

<p>编译<a href="SL-SurfaceShaders.html">表面着色器</a>时，表面着色器会为各种通道生成大量代码以产生光照。编译每个通道时，将定义以下宏之一：</p>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;"><strong>宏：</strong></th>
	<th style="text-align:left;"><strong>用途：</strong></th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;"><code>UNITY_PASS_FORWARDBASE</code></td>
	<td style="text-align:left;">前向渲染基础通道（主方向光、光照贴图和 SH）。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_PASS_FORWARDADD</code></td>
	<td style="text-align:left;">前向渲染附加通道（每个通道一个光源）。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_PASS_DEFERRED</code></td>
	<td style="text-align:left;">延迟着色通道（渲染 G 缓冲区）。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_PASS_SHADOWCASTER</code></td>
	<td style="text-align:left;">阴影投射物和深度纹理渲染通道。</td>
</tr>
</tbody>
</table>

<h2>禁用自动升级</h2>

<p><code>UNITY_SHADER_NO_UPGRADE</code> 允许您禁止 Unity 自动升级或修改着色器文件。</p>

<h2>深度纹理 helper 宏</h2>

<p>大多数情况下，深度纹理用于渲染距离摄像机的深度。在此情况下，<a href="SL-BuiltinIncludes.html">UnityCG.cginc include 文件</a>包含的一些宏可以处理上述复杂问题：</p>

<ul>
<li>
<strong>UNITY_TRANSFER_DEPTH(o)</strong>：计算顶点的眼睛空间深度并将其在 <strong>o</strong> 中输出（必须是 float2）。当渲染到深度纹理时，在顶点程序中使用此宏。在具有本机深度纹理的平台上，此宏完全不执行任何操作，因为 Z 缓冲区值是隐式渲染的。</li>
<li>
<strong>UNITY_OUTPUT_DEPTH(i)</strong>：从 <strong>i</strong> 返回眼睛空间深度（必须为 float2）。当渲染到深度纹理时，在片元程序中使用此宏。在具有本机深度纹理的平台上，此宏始终返回零，因为 Z 缓冲区值是隐式渲染的。</li>
<li>
<strong>COMPUTE_EYEDEPTH(i)</strong>：计算顶点的眼睛空间深度并将其在 <strong>o</strong> 中输出。当<strong>不</strong>渲染到深度纹理时，在顶点程序中使用此宏。</li>
<li>
<strong>DECODE_EYEDEPTH(i)/LinearEyeDepth(i)</strong>：通过深度纹理 <strong>i</strong> 给出高精度值时，返回相应的眼睛空间深度。</li>
<li>
<strong>Linear01Depth(i)</strong>：通过深度纹理 <strong>i</strong> 给出高精度值时，返回相应的线性深度，范围在 0 到 1 之间。</li>
</ul>

<p><strong>Note:</strong> On DX11/12 and Metal, the Z buffer range is 1–0 and UNITY_REVERSED_Z is defined. On other platforms, the range is 0–1.</p>

<p>例如，以下着色器将渲染其游戏对象的深度：</p>

<pre><code>Shader "Render Depth" {
    SubShader {
        Tags { "RenderType"="Opaque" }
        Pass {
            CGPROGRAM

            #pragma vertex vert
            #pragma fragment frag
            #include "UnityCG.cginc"

            struct v2f {
                float4 pos : SV_POSITION;
                float2 depth : TEXCOORD0;
            };

            v2f vert (appdata_base v) {
                v2f o;
                o.pos = UnityObjectToClipPos(v.vertex);
                UNITY_TRANSFER_DEPTH(o.depth);
                return o;
            }

            half4 frag(v2f i) : SV_Target {
                UNITY_OUTPUT_DEPTH(i.depth);
            }
            ENDCG
        }
    }
}
</code></pre>
<div id="_content"></div>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="SL-BuiltinIncludes.html"></a></span><div class="tip">内置着色器 include 文件</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="SL-BuiltinFunctions.html"></a></span><div class="tip">内置着色器 helper 函数</div>
</div>
</div>
</div>
<div class="footer-wrapper"><div class="footer clear">
<div class="copy">Copyright © 2022 Unity Technologies. Publication 2022.3</div>
<div class="menu">
<a href="https://learn.unity.com/">教程</a><a href="https://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="https://forum.unity3d.com">论坛</a><a href="https://unity3d.com/asset-store">Asset Store</a><a href="https://docs.unity3d.com/Manual/TermsOfUse.html">商标和使用条款</a><a href="https://unity.com/legal">法律条款</a><a href="https://unity.com/legal/privacy-policy">隐私政策</a><a href="https://unity.com/legal/cookie-policy">Cookie</a><a href="https://unity.com/legal/do-not-sell-my-personal-information">不要出售或分享我的个人信息</a><div id="ot-sdk-btn-container"><a id="ot-sdk-btn" class="ot-sdk-show-settings" href="javascript:void(0);">Your Privacy Choices (Cookie Settings)</a></div>
</div>
</div></div>
</div></div></div>
</div>
</body>
</html>
